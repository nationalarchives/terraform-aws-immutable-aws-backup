
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Terraform module for Immutable AWS Backup">
      
      
        <meta name="author" content="The National Archives">
      
      
        <link rel="canonical" href="https://nationalarchives.github.io/terraform-aws-immutable-aws-backup/usage-configuration/">
      
      
        <link rel="prev" href="../usage-prerequisites/">
      
      
        <link rel="next" href="../usage-backing-up-your-resources/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Configuration - Immutable AWS Backup Terraform module</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Configuration - Immutable AWS Backup Terraform module" >
      
        <meta  property="og:description"  content="Terraform module for Immutable AWS Backup" >
      
        <meta  property="og:image"  content="https://nationalarchives.github.io/terraform-aws-immutable-aws-backup/assets/images/social/usage-configuration.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://nationalarchives.github.io/terraform-aws-immutable-aws-backup/usage-configuration/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Configuration - Immutable AWS Backup Terraform module" >
      
        <meta  name="twitter:description"  content="Terraform module for Immutable AWS Backup" >
      
        <meta  name="twitter:image"  content="https://nationalarchives.github.io/terraform-aws-immutable-aws-backup/assets/images/social/usage-configuration.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Immutable AWS Backup Terraform module" class="md-header__button md-logo" aria-label="Immutable AWS Backup Terraform module" data-md-component="logo">
      
  <img src="../assets/images/tna-96x96.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Immutable AWS Backup Terraform module
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuration
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/nationalarchives/terraform-aws-immutable-aws-backup" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    nationalarchives/terraform-aws-immutable-aws-backup
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Immutable AWS Backup Terraform module" class="md-nav__button md-logo" aria-label="Immutable AWS Backup Terraform module" data-md-component="logo">
      
  <img src="../assets/images/tna-96x96.png" alt="logo">

    </a>
    Immutable AWS Backup Terraform module
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nationalarchives/terraform-aws-immutable-aws-backup" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    nationalarchives/terraform-aws-immutable-aws-backup
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../why-use-this-module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Why use this module?
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Using the module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Using the module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployments" class="md-nav__link">
    <span class="md-ellipsis">
      Deployments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plans" class="md-nav__link">
    <span class="md-ellipsis">
      Plans
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rules
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage-backing-up-your-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backing up your resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage-restoring-your-backups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restoring your backups
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="configuration">Configuration</h1>
<p>The module is designed to be deployed only once per Organization, it can be deployed multiple times as long as <a href="#inputs_central_account_resource_name_prefix"><code>central_account_resource_name_prefix</code></a> is unique to each module call. Within the configuration of the module you can define multiple deployments to target areas of your organization with tailored backup plans.</p>
<h2 id="inputs">Inputs</h2>
<!-- prettier-ignore-start -->
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><a name="inputs_central_account_resource_name_prefix"></a> <a href="#inputs_central_account_resource_name_prefix">central_account_resource_name_prefix</a></td>
<td>Prefix to be used for resource names in the central account.</td>
<td><code>string</code></td>
<td></td>
<td>yes</td>
</tr>
<tr>
<td><a name="inputs_deployments"></a> <a href="#inputs_deployments">deployments</a></td>
<td>A map of deployments, see <a href="#deployments">Deployments</a></td>
<td><code>map(object)</code></td>
<td></td>
<td>yes</td>
</tr>
<tr>
<td><a name="inputs_member_account_resource_name_prefix"></a> <a href="#inputs_member_account_resource_name_prefix">member_account_resource_name_prefix</a></td>
<td>Prefix to be used for resource names in member accounts.</td>
<td><code>string</code></td>
<td></td>
<td>yes</td>
</tr>
<tr>
<td><a name="inputs_terraform_state_bucket_name"></a> <a href="#inputs_terraform_state_bucket_name">terraform_state_bucket_name</a></td>
<td>Name of the S3 bucket used for storing Terraform state files for resources in workload accounts. If not specified, an S3 bucket will be created in the central account.</td>
<td><code>string</code></td>
<td></td>
<td>no</td>
</tr>
</tbody>
</table>
<!-- prettier-ignore-end -->

<h3 id="deployments">Deployments</h3>
<p>A deployment is an instance of the backup solution. Within the deployment account it creates a single set of resources (Backup Vaults, KMS Key, CloudFormation StackSet, etc.) that can then be used by multiple workload accounts. Deployments create a <strong>security boundary</strong> for your backups. Deployments are passed to the module as a map, the key value for each deployment is used to generate unique resource names within the deployment account and workload accounts.</p>
<!-- prettier-ignore-start -->
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><a name="deployments_admin_role_names"></a> <a href="#deployments_admin_role_names">admin_role_names</a></td>
<td>A list of role names that will have administrator abilities in member accounts. For example, administering the Backup Vaults.</td>
<td><code>list(string)</code></td>
<td><code>[]</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="deployments_allow_backup_targets_to_restore"></a> <a href="#deployments_allow_backup_targets_to_restore">allow_backup_targets_to_restore</a></td>
<td>Allow restores within the <code>backup_targets</code> workload accounts. This will share the LAG Vault back to workload accounts through AWS RAM.</td>
<td><code>bool</code></td>
<td><code>false</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="deployments_backup_tag_key"></a> <a href="#deployments_backup_tag_key">backup_tag_key</a></td>
<td>The tag key to query when <code>require_plan_name_resource_tag</code> is enabled within a plan.</td>
<td><code>string</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="deployments_backup_targets"></a> <a href="#deployments_backup_targets">backup_targets</a></td>
<td>A list of Organizational Unit IDs to deploy the backup solution to. The module will deploy to all accounts within these OUs.</td>
<td><code>list(string)</code></td>
<td></td>
<td>yes</td>
</tr>
<tr>
<td><a name="deployments_max_retention_days"></a> <a href="#deployments_max_retention_days">max_retention_days</a></td>
<td>The maximum retention to configure on the Backup Vaults. Required when a plan is using a LAG Vault.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="deployments_min_retention_days"></a> <a href="#deployments_min_retention_days">min_retention_days</a></td>
<td>The minimum retention to configure on the Backup Vaults. Required when a plan is using a LAG Vault.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="deployments_plans"></a> <a href="#deployments_plans">plans</a></td>
<td>A map of backup plans to implement, see <a href="#plans">Plans</a>.</td>
<td><code>map(object)</code></td>
<td></td>
<td>yes</td>
</tr>
<tr>
<td><a name="deployments_retained_vaults"></a> <a href="#deployments_retained_vaults">retained_vaults</a></td>
<td>A list of previously deployed Backup Vault configurations. This is used to retain Vaults that were previously configured and are now locked, preventing deletion. This is useful when changing the configuration of a deployment, such as changing the minimum or maximum retention days.</td>
<td><code>list(object({ min_retention_days = number, max_retention_days = number, use_logically_air_gapped_vault = optional(bool, false) }))</code></td>
<td><code>[]</code></td>
<td>no</td>
</tr>
</tbody>
</table>
<!-- prettier-ignore-end -->

<h3 id="plans">Plans</h3>
<p>A plan defines a selection of resources and a list of rules (when your backups should be taken) for AWS Backup to orchestrate. This module generates AWS Backup Plans based upon the configuration made here; the module implements additional functionality to simplify the configuration of AWS Backup and implement AWS guidance. Plans are passed to the module as a map, the key value for each plan is used to identify the plan and filter by resource tag when <code>require_plan_name_resource_tag</code> is enabled.</p>
<!-- prettier-ignore-start -->
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><a name="plans_complete_backup_window_minutes"></a> <a href="#plans_complete_backup_window_minutes">complete_backup_window_minutes</a></td>
<td>Number of minutes after a backup job is successfully started before it must be completed or it will be canceled by AWS Backup.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_continuous_backup_schedule_expression"></a> <a href="#plans_continuous_backup_schedule_expression">continuous_backup_schedule_expression</a></td>
<td>A cron expression for when to create <a href="https://docs.aws.amazon.com/aws-backup/latest/devguide/point-in-time-recovery.html">Continuous Backups</a> of supported and enabled resources. It is recommended to set this outside of the backup windows defined in your rules and to run it regularly.</td>
<td><code>string</code></td>
<td><code>"cron(0 0 ? * * *)"</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_create_continuous_backups"></a> <a href="#plans_create_continuous_backups">create_continuous_backups</a></td>
<td>Create continuous backups for resources that support it to enable point in time recovery within the same account. These backups are not copied to the immutable backup vaults.<br/><br/>Supported resource types: RDS database instances, SAP HANA, S3.</td>
<td><code>bool</code></td>
<td><code>false</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_intermediate_retention_days"></a> <a href="#plans_intermediate_retention_days">intermediate_retention_days</a></td>
<td>The number of days to retain backups in the Intermediate Vault once copied to the Immutable Vault. Persisting backups in this vault can reduce copy latency through incremental backups. If not set will use the rule's <code>delete_after_days</code> configuration or 7 days if null. Can be overridden by setting on the rule.</td>
<td><code>number</code></td>
<td>Rule's <code>delete_after_days</code> or <code>7</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_local_retention_days"></a> <a href="#plans_local_retention_days">local_retention_days</a></td>
<td>The number of days to retain backups in the workload account vaults once copied to the Intermediate or LAG vaults. Persisting backups in this vault can reduce backup latency through incremental backups. If not set will use the rule's <code>delete_after_days</code> configuration. Can be overridden by setting on the rule. This does not affect Continuous Backups.</td>
<td><code>number</code></td>
<td>Rule's <code>delete_after_days</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_require_plan_name_resource_tag"></a> <a href="#plans_require_plan_name_resource_tag">require_plan_name_resource_tag</a></td>
<td>Only backup resources that have a resource tag with key <a href="#deployments_backup_tag_key"><code>backup_tag_key</code></a> and value matching the plan name.</td>
<td><code>bool</code></td>
<td><code>true</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_snapshot_from_continuous_backups"></a> <a href="#plans_snapshot_from_continuous_backups">snapshot_from_continuous_backups</a></td>
<td>Create continuous backups for resources that support it and then generate snapshot backups from these. Recommended by AWS to reduce cost.<br/><br/>Supported resource types: S3.</td>
<td><code>bool</code></td>
<td><code>true</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_start_backup_window_minutes"></a> <a href="#plans_start_backup_window_minutes">start_backup_window_minutes</a></td>
<td>Number of minutes to wait for a backup job to start before cancelling it. If this value is included, it must be at least 60 minutes to avoid errors.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_use_logically_air_gapped_vault"></a> <a href="#plans_use_logically_air_gapped_vault">use_logically_air_gapped_vault</a></td>
<td>Copy backups to a Logically Air Gapped Vault for supported resource types. Logically Air Gapped Vaults enable faster recovery as backups can be restored cross-account.</td>
<td><code>bool</code></td>
<td><code>false</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="plans_rules"></a> <a href="#plans_rules">rules</a></td>
<td>A list of backup rules to implement, defining when backups should be taken. Where rules have overlapping start windows, the rule with the greatest <code>delete_after_days</code> value will run. See <a href="#rules">Rules</a>.</td>
<td><code>list</code></td>
<td></td>
<td>yes</td>
</tr>
</tbody>
</table>
<!-- prettier-ignore-end -->

<h3 id="rules">Rules</h3>
<p>A rule defines when backups should be taken and how long they should be kept for. Where rules within a plan have overlapping start windows, the rule with the greatest <code>delete_after_days</code> value will run.</p>
<!-- prettier-ignore-start -->
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Default</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td><a name="rules_complete_backup_window_minutes"></a> <a href="#rules_complete_backup_window_minutes">complete_backup_window_minutes</a></td>
<td>Number of minutes after a backup job is successfully started before it must be completed or it will be canceled by AWS Backup. Overrides the <a href="#plans_complete_backup_window_minutes">value set on the plan</a>.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="rules_delete_after_days"></a> <a href="#rules_delete_after_days">delete_after_days</a></td>
<td>The number of days a backup should be retained for. Required when the plan is using a LAG Vault.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="rules_intermediate_retention_days"></a> <a href="#rules_intermediate_retention_days">intermediate_retention_days</a></td>
<td>The number of days to retain backups in the Intermediate Vault once copied to the Immutable Vault. Overrides the <a href="#plans_intermediate_retention_days">value set on the plan</a>.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="rules_local_retention_days"></a> <a href="#rules_local_retention_days">local_retention_days</a></td>
<td>The number of days to retain backups in the workload account vaults once copied to the Intermediate or LAG vaults. Overrides the <a href="#plans_local_retention_days">value set on the plan</a>.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
<tr>
<td><a name="rules_name"></a> <a href="#rules_name">name</a></td>
<td>A friendly name for the rule.</td>
<td><code>string</code></td>
<td>Rule's index number</td>
<td>no</td>
</tr>
<tr>
<td><a name="rules_schedule_expression"></a> <a href="#rules_schedule_expression">schedule_expression</a></td>
<td>A cron expression for when to start the backup window.</td>
<td><code>string</code></td>
<td></td>
<td>yes</td>
</tr>
<tr>
<td><a name="rules_start_backup_window_minutes"></a> <a href="#rules_start_backup_window_minutes">start_backup_window_minutes</a></td>
<td>Number of minutes to wait for a backup job to start before cancelling it. If this value is included, it must be at least 60 minutes to avoid errors. Overrides the <a href="#plans_start_backup_window_minutes">value set on the plan</a>.</td>
<td><code>number</code></td>
<td><code>null</code></td>
<td>no</td>
</tr>
</tbody>
</table>
<!-- prettier-ignore-end -->







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/nationalarchives/terraform-aws-immutable-aws-backup" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "pymdownx.snippets", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>